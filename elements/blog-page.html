<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../elements/project-page.html">
<link rel="import" href="../elements/blog-card.html">

<dom-module id="blog-page">
    <link rel="import" type="css" href="../css/normalize.css">
    <link rel="import" type="css" href="../css/skeleton.css">
    <template>
        
        <project-page on-click="expandBlog">
                <div class="intro">
                    <h3 on-click="expandBlog">Because every blog needs a second site to show</h3>
                </div>
                <div class="expand">
                    <template is="dom-repeat" items="{{posts}}">
                        <blog-card titleline="{{item.title}}"
                                   date="{{item.date}}"
                                   blog="{{item.body}}"
                                   on-click="expandBlog"
                                   ></blog-card>
                    </template>
                </div>
            </project-page>
    
     </template>

    
</dom-module>
<script>
        (function () {
            Polymer({
                is:"blog-page",
                expandBlog:function(e){
                    var index=e.model.index;
                    app.goArticle();
                    
                    var article=app.pages.children[app.article];
                    
                    article.titleline=this.posts[index].titleline;
                    article.date=this.posts[index].date;
                    article.blogBody.innerHTML=this.posts[index].blog;
                    
                },
                ready:function(){
                    app.posts=(app.posts==null)?[]:app.posts;
                    var that=this;
                    aja()
                        .url('http://api.tumblr.com/v2/blog/yiochen.tumblr.com/posts/text?api_key=0q6nbQaibqLbvTRQoOYiHqQEJbcHSMtgNIcdopG1NfVrBZF9b5&limit=10&offset=0')
                        .type('jsonp')
                        .on('success',function(data){
                            for (var i=0;i<data.response.posts.length;i++){
                                var post=app.posts[app.posts.length]={};
                                post.title=data.response.posts[i].title;
                                post.date=data.response.posts[i].date;
                                post.id=data.response.posts[i].id;
                                post.body=data.response.posts[i].body;
                            }
                            that.posts=app.posts; 
                        }).go();
                },
                refresh:function(){
                    document.body.scrollTop = document.documentElement.scrollTop = 0;
                }
                

            });
        })();
    </script>